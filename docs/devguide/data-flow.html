<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Organization">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1">
<meta name="google-site-verification" content="k0e8DrbD40s54xHNBqwIsRrSSAkZoprwtEYDnNY06bU" />
<meta name="google-site-verification" content="pnjjbQFvjPwaWhEXY6nSyaS9iyghmH-M_yLHBveDX2M">
<meta itemprop="name" content="AWIPS II - Data flow">
<meta itemprop="description" content="Polymer is a library that uses the latest web technologies to let you create custom HTML elements. Build anything from a button to a complete application as an encapsulated, reusable element that works across desktop and mobile.">


<meta itemprop="image" content="https://www.polymer-project.org/images/instacod.png">


<title>
  
    Data flow -
   AWIPS II
</title>
<link rel="publisher" href="https://plus.google.com/107187849809354688692">
<link rel="shortcut icon" href="http://www.unidata.ucar.edu/favicon.ico">
<link href="//fonts.googleapis.com/css?family=RobotoDraft:300,400,500|Source+Code+Pro:400,500,700" rel="stylesheet">
<link href="/polymer-docs/css/site2.css?20160403" rel="stylesheet">
<link href="/polymer-docs/css/site2_sd_rules.css?20160403" rel="stylesheet" shim-shadowdom>



<script src="/polymer-docs/components/webcomponentsjs/webcomponents.min.js?20160403"></script>
<!-- TODO: remove when https://github.com/Polymer/polymer/issues/391 is fixed -->
<link rel="import" href="/polymer-docs/components/polymer/polymer.html">
<link rel="stylesheet" href="/polymer-docs/css/elements/docs-menu.css">
<link rel="import" href="/polymer-docs/elements/common_elements.vulcanized.html?20160403">


</head>
<body id="data-flow">

<main id="content-container" class="polymer-content">
  <app-drawer id="sidebar" unresolved>
    <div layout vertical id="sidebar-content">
      <div id="logo-container" layout horizontal center>
        <a href="/polymer-docs/" class="logo"><img src="/polymer-docs/images/logos/awips2.png" alt="AWIPS II User Guide"></a>
      </div>

      <docs-menu unresolved flex
		 baseurl='/polymer-docs'
                 coreElements='{"core-header-panel":"components/core-header-panel/core-header-panel.html","core-transition-pages":"components/core-animated-pages/transitions/core-transition-pages.html","core-animated-pages":"components/core-animated-pages/core-animated-pages.html","core-overlay":"components/core-overlay/core-overlay.html","core-toolbar":"components/core-toolbar/core-toolbar.html","core-image":"components/core-image/core-image.html","core-shared-lib":"components/core-shared-lib/core-shared-lib.html","core-a11y-keys":"components/core-a11y-keys/core-a11y-keys.html","core-menu-button":"components/core-menu-button/core-menu-button.html","core-icon":"components/core-icon/core-icon.html","core-selection":"components/core-selection/core-selection.html","core-style":"components/core-style/core-style.html","core-menu":"components/core-menu/core-menu.html","core-submenu":"components/core-menu/core-submenu.html","core-list":"components/core-list/core-list.html","core-dropdown-menu":"components/core-dropdown-menu/core-dropdown-menu.html","core-input":"components/core-input/core-input.html","core-iconset-svg":"components/core-iconset-svg/core-iconset-svg.html","core-field":"components/core-field/core-field.html","core-selector":"components/core-selector/core-selector.html","core-media-query":"components/core-media-query/core-media-query.html","core-animation-group":"components/core-animation/core-animation-group.html","core-animation":"components/core-animation/core-animation.html","core-animation-keyframe":"components/core-animation/core-animation.html","core-animation-prop":"components/core-animation/core-animation.html","core-dropdown":"components/core-dropdown/core-dropdown.html","core-dropdown-base":"components/core-dropdown/core-dropdown-base.html","core-pages":"components/core-pages/core-pages.html","core-meta":"components/core-meta/core-meta.html","core-splitter":"components/core-splitter/core-splitter.html","core-scroll-header-panel":"components/core-scroll-header-panel/core-scroll-header-panel.html","core-tooltip":"components/core-tooltip/core-tooltip.html","core-localstorage":"components/core-localstorage/core-localstorage.html","core-scroll-threshold":"components/core-scroll-threshold/core-scroll-threshold.html","core-drag-drop":"components/core-drag-drop/core-drag-drop.html","core-iconset":"components/core-iconset/core-iconset.html","core-label":"components/core-label/core-label.html","core-signals":"components/core-signals/core-signals.html","core-transition":"components/core-transition/core-transition.html","core-scaffold":"components/core-scaffold/core-scaffold.html","core-drawer-panel":"components/core-drawer-panel/core-drawer-panel.html","core-range":"components/core-range/core-range.html","core-collapse":"components/core-collapse/core-collapse.html","core-xhr":"components/core-ajax/core-xhr.html","core-ajax":"components/core-ajax/core-ajax.html","core-icon-button":"components/core-icon-button/core-icon-button.html","core-item":"components/core-item/core-item.html"}'
                 paperElements='{"paper-dropdown":"components/paper-dropdown/paper-dropdown.html","paper-dropdown-transition":"components/paper-dropdown/paper-dropdown-transition.html","paper-item":"components/paper-item/paper-item.html","paper-dropdown-menu":"components/paper-dropdown-menu/paper-dropdown-menu.html","paper-checkbox":"components/paper-checkbox/paper-checkbox.html","paper-button":"components/paper-button/paper-button.html","paper-button-base":"components/paper-button/paper-button-base.html","paper-menu-button":"components/paper-menu-button/paper-menu-button.html","paper-radio-group":"components/paper-radio-group/paper-radio-group.html","paper-toast":"components/paper-toast/paper-toast.html","paper-char-counter":"components/paper-input/paper-char-counter.html","paper-autogrow-textarea":"components/paper-input/paper-autogrow-textarea.html","paper-input":"components/paper-input/paper-input.html","paper-input-decorator":"components/paper-input/paper-input-decorator.html","paper-slider":"components/paper-slider/paper-slider.html","paper-toggle-button":"components/paper-toggle-button/paper-toggle-button.html","paper-fab":"components/paper-fab/paper-fab.html","paper-ripple":"components/paper-ripple/paper-ripple.html","paper-icon-button":"components/paper-icon-button/paper-icon-button.html","paper-tabs":"components/paper-tabs/paper-tabs.html","paper-tab":"components/paper-tabs/paper-tab.html","paper-shadow":"components/paper-shadow/paper-shadow.html","paper-radio-button":"components/paper-radio-button/paper-radio-button.html","paper-dialog":"components/paper-dialog/paper-dialog.html","paper-action-dialog":"components/paper-dialog/paper-action-dialog.html","paper-dialog-base":"components/paper-dialog/paper-dialog-base.html","paper-dialog-transition":"components/paper-dialog/paper-dialog-transition.html","paper-spinner":"components/paper-spinner/paper-spinner.html","paper-progress":"components/paper-progress/paper-progress.html"}'></docs-menu>
    </div>
  </app-drawer>

  <scroll-area sidebar unresolved class="scrolling">
    <site-banner type="guide" shortname="Docs" unresolved>
      
<app-bar theme="light" class="bar fixed">
</app-bar>

      <header class="shrink">
        <h1>
        
          EDEX Admin
        : Data flow
        </h1>
      </header>
    </site-banner>

    
    

    <article class="show-permalinks">

      <header class="onlyonmobile">
        <h1>
          
          EDEX Admin
          : Data flow
        </h1>
      </header>

      <h2 id="data-receipt">Data Receipt</h2>

<ol>
  <li>The LDM obtains a data product from an upstream LDM site on the IDD.
    <ul>
      <li>The LDM writes the data to file in Raw Data Storage.</li>
      <li>The LDM uses edexBridge to post a “data available” message to the Qpid message broker.</li>
      <li>The EDEX Ingest process obtains the “data available” message from Qpid and removes the message from the message queue.</li>
      <li>The EDEX Ingest process obtains the data files from Raw Data Storage.</li>
    </ul>
  </li>
</ol>

<p>This architecture provides separation between data sources and ingest processing.  Any data source, not just the LDM/IDD, can follow this architecture to provide data for EDEX to process.</p>

<h2 id="data-decoding">Data Decoding</h2>

<p>Data decoding is defined as the process of converting data from a raw format into a decoded format that is usable by CAVE.  In AWIPS II, data decoding is performed by the EDEX Ingest proessing (<strong>ingest</strong> and <strong>ingestGrib</strong>).</p>

<ol>
  <li>EDEX Ingest obtains the “data available” message from the Qpid message broker, and determines the appropriate data decoder based on the message contents. EDEX Ingest then forwards the message to the chosen decoder.  Finally, the message is removed from the message queue.</li>
  <li>EDEX Ingest reads the data from Raw Data Storage.</li>
  <li>EDEX Ingest decodes the data.</li>
  <li>EDEX Ingest forwards the decoded data to Processed Data Storage.</li>
  <li>EDEX Ingest sends a message to the CAVE client indicating that newly-decoded data is available.</li>
</ol>

<p>It is important to note that in AWIPS II all data types are processed by either the standard <strong>ingest</strong> process, or by the <strong>ingestGrib</strong> process, which handles all grib message ingestion. Once this data decoding process is complete, clients may obtain and perform additional processing on the data, including displaying data in CAVE.</p>

<h3 id="processed-data-storage-architecture">Processed Data Storage Architecture</h3>

<p>Processed Data Storage refers to the persistence of decoded data and occurs in two separate forms: 1) metadata and some decoded data, which is stored in Postgres database tables; and 2) imagery data, gridded forecast data, and certain point data, which is stored in HDF5 files, and is managed by PyPIES.</p>

<p>Writing to Processed Data Storage involves the following:</p>

<ul>
  <li>1) The <strong>EDEX Process</strong> sends serialized data, area data, and certain point data to PyPIES.</li>
  <li>2) <strong>PyPIES</strong> writes the data to the HDF5 data store.</li>
  <li>3) <strong>EDEX</strong> send the metadata to the Postgres DBMS</li>
  <li>4) <strong>Postgres</strong> writes the metadata to the AWIPS II database.</li>
</ul>

<p>For data not stored in HDF5, Steps 1 and 2 are skipped.</p>

<p>For processed data retrieval, the process is revered:</p>

<ul>
  <li>3) <strong>EDEX</strong> requests the metadata from Postgres.</li>
  <li>4) <strong>Postgres</strong> reads the AWIPS II database and returns the requested metadata to EDEX.</li>
  <li>1) <strong>EDEX</strong> sends a data request to PyPIES.</li>
  <li>2) <strong>PyPIES</strong> reads the data from the HDF5 data store and returns it to EDEX.</li>
</ul>

<p>In this case, if the data is not stored in HDF5, then Steps 3 and 4 are skipped.</p>

<h3 id="data-retrieval-architecture">Data Retrieval Architecture</h3>

<p>Data retrieval is the process by which the CAVE client obtains data using the EDEX Request server; the Request server obtains the data from processed data storage (Postgres and HDF5) and returns it to CAVE.  The basic data retrieval process is shown in Figure 1.5.4-1.</p>

<ol>
  <li><strong>CAVE</strong> sends a request via TCP to the EDEX Request server.</li>
  <li><strong>EDEX Request</strong> server obtains the requested metadata via Postgres and stored data via PyPIES.</li>
  <li><strong>EDEX Request</strong> forwards the requested data directly back to the CAVE client.</li>
</ol>

<p>For clustered EDEX servers using IPVS, this architecture allows CAVE clients to access any available EDEX Request process, providing an improvement in system reliability and speed.  Data retrieval from processed data storage follows the same pattern as data storage: retrieval of HDF5 is handled by PyPIES; retrieval of database data is handled by Postgres.</p>

<h2 id="data-purge-architecture">Data Purge Architecture</h2>

<p>Raw data storage and processed data storage use two different purge mechanisms.  For processed data storage, AWIPS II implements a plugin based purge strategy, where the user has the option to change the purge frequency for each plugin individually.</p>

<h3 id="raw-data-purge">Raw Data Purge</h3>

<p>Purging of Raw Data Storage is managed by the LDM user account cron, which executes the ldmadmin scour process, removing data files using an age-based strategy.  The directories and retention times for raw data storage are controlled by <em>scour.conf</em>, which is located in the ldm user’s <em>~/etc/</em> directory.  Each entry in scour.conf contains the directory to manage, the retention time and an optional file name pattern for data files.</p>

<ol>
  <li>An <strong>ldm</strong> user cron job executes ldmadmin.</li>
  <li><strong>ldmadmin</strong> executes the LDM scour program.</li>
  <li>The <strong>LDM scour program</strong> deletes outdated data from AWIPS II Raw Data Storage.</li>
</ol>

<h3 id="processed-data-purge">Processed Data Purge</h3>

<p>Rules for this version-based purge are contained in XML files located in <strong>/awips2/edex/data/utility/</strong>.  The purge is triggered by a quartz timer event that fires at 30 minutes after each hour.</p>

<ol>
  <li>A <strong>Quartz</strong> event is triggered in the EDEX Ingest process causing the Purge Service to obtain a purge lock.  If the lock is already taken, the Purge Service will exit, ensuring that only a single EDEX Ingest process performs the purge.</li>
  <li>The <strong>EDEX Purge Service</strong> sends a delete message to Postgres.</li>
  <li><strong>Postgres</strong> deletes the specified data from the database.</li>
  <li>If HDF5 data is to be purged, the <strong>Purge Service</strong> messages PyPIES.</li>
  <li><strong>PyPIES</strong> deletes the specified HDF5 files.</li>
</ol>

    </article>

    <footer>
  <div>
    <div class="links">
      <a href="https://www.facebook.com/unidata" title="Unidata on Facebook" tabindex="-1"><paper-button><core-icon icon="social:post-facebook"></core-icon>Facebook</paper-button></a>
      <a href="https://twitter.com/intent/follow?screen_name=unidata" data-twitter-follow title="Follow @Unidata on Twitter" tabindex="-1"><paper-button><core-icon icon="social:post-twitter"></core-icon>Twitter</paper-button></a>
      <a href="https://github.com/Unidata/awips2"><paper-button class="github" tabindex="-1"><core-icon icon="social:post-github"></core-icon>GitHub</paper-button></a>
      <a href="https://github.com/Unidata/awips2/issues/new" tabindex="-1"><paper-button><core-icon icon="bug-report"></core-icon>File a bug</paper-button></a>
    </div>

  </div>
</footer>





<script src="/polymer-docs/js/prettify/prettify.js"></script>

<!-- <script src="/polymer-docs/js/bower_components/smoothscroll/smoothscroll.js"></script> -->
<script src="/polymer-docs/js/app.js?20160403"></script>


  </scroll-area>

</main>

</body>
</html>
